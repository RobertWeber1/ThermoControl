#pragma once

namespace web
{

static constexpr char main_page[] = R"XML(<html lang="en"><head><meta charset="utf-8"/><meta name="viewport" content="width=device-width"/><title>ThermoControl</title><style>body{ margin: 0; background: #EFEFEF; } #Connecting { width: 100%; background-color: grey; text-align: center; color: white; } #ConnectingContent { display: flex; justify-content: center; align-items: center; } .Spinner { margin-left: 5px; border: 6px solid #f3f3f3; /* Light grey */ border-top: 6px solid #3498db; /* Blue */ border-radius: 50%; width: 15px; height: 15px; animation: spin 4s linear infinite; } #Connected{ margin:0; } #Main{ display: flex; justify-content: center; align-items: center; flex-direction: column; } #HeadLine{ margin: 0; border: 0; width: 100%; background-color: #4AA87E; text-align: center; color: white; } @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } } .channel { } </style><link rel="shortcut icon" href="data:image/ico;base64,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"/><script>var connection = null; var reconnect_timer = null; function open_web_socket() { console.log("try connect"); if(reconnect_timer != null) { clearTimeout(reconnect_timer); reconnect_timer = null; } connection = new WebSocket('ws://192.168.4.1:8080/', ['Display']); var heartbeat_interval = null; var missed_heartbeats = 0; function check_heartbeat() { clearInterval(heartbeat_interval); missed_heartbeats = 0; } connection.onopen = function () { missed_heartbeats = 0; check_heartbeat(); clearInterval(heartbeat_interval); heartbeat_interval = setInterval(function() { connection.send('---Heatbeat---'); }, 1000); connected_event(); }; connection.onmessage = function (msg) { if(msg.data === '---Heatbeat---') { missed_heartbeats = 0; connection.send('---Heatbeat---'); } else { process_message(msg.data); } }; connection.onerror = function () { console.log('WebSocket closed, try reconnect in 500ms...'); reconnect_timer = setTimeout(open_web_socket, 50000); clearInterval(heartbeat_interval); }; connection.onclose = function () { console.log('connecton closed by Server?'); connection.onerror(); }; } function enable(id) { document.getElementById(id).disabled = false; document.getElementById(id).style.display = 'block'; } function disable(id) { document.getElementById(id).style.display = 'none'; } function setup(count) { console.log("setup ", count, " channels"); for(var index = 0; index < count; index++) { const channel = document.createElement('div'); channel.className = "channel"; channel.id = index; var off_button = document.createElement('button'); off_button.id = index + "OFF"; off_button.innerHTML = "OFF"; off_button.addEventListener( "click", function() { console.log("turnOFF"); send_command("switch", [index, "OFF"]); }); channel.appendChild(off_button); var on_button = document.createElement('button'); on_button.id = index + "ON"; on_button.innerHTML = "ON"; on_button.addEventListener( "click", function() { console.log("turnOFF"); send_command("switch", [index, "OFF"]); }); channel.appendChild(on_button); const upper_p = document.createElement('p'); const upper_input = document.createElement('input'); upper_input.id = index + "UPPER"; upper_input.type = "number"; upper_input.onchange = send_channel_update; upper_input.value = 0; upper_p.innerHTML = "Obergrenze: "; upper_p.append(upper_input); const lower_p = document.createElement('p'); const lower_input = document.createElement('input'); lower_input.id = index + "LOWER"; lower_input.type = "number"; lower_input.onchange = send_channel_update; lower_input.value = 0; lower_p.innerHTML = "Untergrenze: "; lower_p.append(lower_input); channel.append(upper_p); channel.append(lower_p); const p_temp = document.createElement('p'); p_temp.append("Temperatur Sensor: "); const temp = document.createElement('a'); temp.id = index + "temp"; temp.innerHTML = "-"; p_temp.appendChild(temp); channel.appendChild(p_temp); const p_output = document.createElement('p'); p_output.append("Ausgang: "); const output = document.createElement('a'); output.id = index + "output"; output.innerHTML = "-"; p_output.appendChild(output); channel.appendChild(p_output); var channels = document.getElementById('channels'); channels.appendChild(channel); } } function process_message(raw_data) { var message = JSON.parse(raw_data); if(message.type == "setup") { console.log(message); setup(message.data); } else if(message.type == "data") { const data = message.data; if(data.automaitc_mode) { disable('AutoModeButton'); enable('ManuModeButton'); } else { enable('AutoModeButton'); disable('ManuModeButton'); } for(const key in data.channels) { const ch_data = data.channels[key]; const on = document.getElementById(key + "OFF"); const off = document.getElementById(key + "ON"); const upper = document.getElementById(key + "UPPER"); const lower = document.getElementById(key + "LOWER"); const temp = document.getElementById(key + "temp"); const output = document.getElementById(key + "output"); if(data.automaitc_mode == false) { on.style = "display:block;"; off.style = "display:block;"; upper.style = "display:none;"; lower.style = "display:none;"; } else { on.style = "display:none;"; off.style = "display:none;"; upper.style = "display:block;"; lower.style = "display:block;"; } if(upper.value != ch_data.upper_bound) { upper.value = ch_data.upper_bound; } if(lower.value != ch_data.lower_bound) { lower.value = ch_data.lower_bound; } if(ch_data.sensor_status == "OK") { temp.innerHTML = ch_data.temperature + " Â°C"; } else { temp.innerHTML = ch_data.sensor_status; } if(ch_data.output) { output.innerHTML = "AN"; } else { output.innerHTML = "AUS"; } } } } function process_state(state) { document.getElementById('State').innerHTML = 'State: ' + state; if((state === "Initial") || (state == "Idle")) { document.getElementById('TextInput').value = ""; } } function connected_event() { document.getElementById('Connecting').style.display = 'none'; document.getElementById('Connected').style.display = 'block'; } function disconnected_event() { document.getElementById('Connecting').style.display = 'block'; document.getElementById('Connected').style.display = 'none'; } function isValid(obj) { for(var key in obj) { if(obj.hasOwnProperty(key)) return true; } return false; } function send_channel_update(event) { send_command("set_limit", [ event.target.parentNode.parentNode.id, event.target.id, event.target.value]); } function send_command(cmd, value) { const data = {}; data[cmd] = value; const str = JSON.stringify(data); console.log("send: ", str); if(connection && connection.readyState == connection.OPEN) { connection.send(str); } } </script></head><body onload="open_web_socket()"><div id="Connecting" style="display:none"><div id="ConnectingContent"><h3>Connecting</h3><div class="Spinner"><p style="display:none"> foo </p></div></div></div><div id="Connected"><div id="Main"><div id="HeadLine"><h3>ThermoControl</h3></div><div id="content"><div><button id="AutoModeButton" onClick='send_command("set_mode", "AUTO")'>Automatic Mode</button><button id="ManuModeButton" onClick='send_command("set_mode", "MANUAL")'>Manual Mode</button></div><div id="channels"/></div></div></div></body></html>)XML";

} //namespace web

